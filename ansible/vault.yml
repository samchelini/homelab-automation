---
- hosts: vault
  gather_facts: false
  roles:
    - create_vm
    - extend-lvm
  vars:
    vm_name: vault
    vm_memory_mb: 1024
    vcenter_resource_pool: ops
    vm_network: ops
    vm_cidr: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          36396532323835306563386238313831343132633362653964656436323238346132373865306230
          3832643839396563363366633233316331323139353866330a333064366132366564353938653065
          35343731363034366262343930323033303565646630396165666630326465646439373636336364
          3731336138356337640a333539303832643233383037653965643837653665336337366637383065
          3230
    vm_gateway: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          33333066666163643630626430353534313865366331383536396332343636613136646435326164
          3832383030663265626639616364363330653937386338390a326364343831363637653066373435
          36333562323462653131623230613530323333613833356433646632363133646530363664653937
          3431366235626130640a633432333532623964316664323539636631616664636463623262663965
          6432

- hosts: vault
  roles:
    - vault
  environment:
    VAULT_ADDR: 'https://{{ common_name }}:8200'
    VAULT_FORMAT: json
  vars:
    common_name: '{{ "vault." + domain_name }}'
    key_dir: /opt/vault/tls/
    key_owner: vault
    key_group: vault
    domain_name: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          35376331656162333031616465646635303735656631343866346132616365653566386638633965
          3263353661363935613565303530396633316466393733360a313862333932316535383162633032
          38386563623566383137353533303231323030613664333563653439323334323832353030623938
          3461336565393361610a313561353833326634313639393364326361303165343762383935373836
          38376334626435323431356134633939346165313863646335346261653636373066
    dc: "{{ domain_name.split('.') | map('regex_replace', '^', 'dc=') | join(',') }}"
    readonly_password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          35653835333065613862333331663939306236663630343337383038393830303633316666663865
          3561373433306535336436376565623137316364373863630a396664623937626630633133376137
          32656161323765613639666465373166376366663033323463393065393463613035326364333231
          6137346539663165370a663733623339633466313063636131613832333261343137373839636639
          3966

