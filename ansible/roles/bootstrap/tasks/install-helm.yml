- name: install helm
  block:
    - name: helm | get keyring
      ansible.builtin.get_url:
        url: https://packages.buildkite.com/helm-linux/helm-debian/gpgkey
        dest: /usr/share/keyrings/helm.gpg
        force: true

    - name: helm | add repo
      ansible.builtin.apt_repository:
        repo: "deb [signed-by=/usr/share/keyrings/helm.gpg] https://packages.buildkite.com/helm-linux/helm-debian/any/ any main"
        state: present

    - name: helm | install
      ansible.builtin.apt:
        update_cache: true
        name: helm
        state: latest
  become: true

- name: install and update helm-diff plugin
  block:
    - name: helm-diff | install
      kubernetes.core.helm_plugin:
        plugin_path: https://github.com/databus23/helm-diff
        state: present

    - name: helm-diff | update
      kubernetes.core.helm_plugin:
        plugin_name: diff
        state: latest
      changed_when: false
