---
- hosts: vault
  roles:
    - extend-lvm
    - vault
  environment:
    VAULT_ADDR: 'https://{{ common_name }}:8200'
    VAULT_FORMAT: json
  vars:
    common_name: '{{ "vault." + domain_name }}'
    key_dir: /opt/vault/tls/
    key_owner: vault
    key_group: vault
    domain_name: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          35376331656162333031616465646635303735656631343866346132616365653566386638633965
          3263353661363935613565303530396633316466393733360a313862333932316535383162633032
          38386563623566383137353533303231323030613664333563653439323334323832353030623938
          3461336565393361610a313561353833326634313639393364326361303165343762383935373836
          38376334626435323431356134633939346165313863646335346261653636373066
    dc: "{{ domain_name.split('.') | map('regex_replace', '^', 'dc=') | join(',') }}"
    readonly_password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          35653835333065613862333331663939306236663630343337383038393830303633316666663865
          3561373433306535336436376565623137316364373863630a396664623937626630633133376137
          32656161323765613639666465373166376366663033323463393065393463613035326364333231
          6137346539663165370a663733623339633466313063636131613832333261343137373839636639
          3966

